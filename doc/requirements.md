# 数独ソルバー Webアプリケーション 要件定義書

## 1. 概要

深さ優先探索（DFS）アルゴリズムを用いた数独パズルソルバー。解析過程をリアルタイムで視覚化し、サイバーパンク風の演出を施したWebアプリケーション。

---

## 2. 技術スタック

| カテゴリ | 技術 |
|---------|------|
| フレームワーク | React 18 + TypeScript |
| ビルドツール | Vite |
| スタイリング | Tailwind CSS |
| アニメーション | CSS Animations / Framer Motion |
| 状態管理 | React Hooks (useState, useReducer) |

---

## 3. 画面構成

### 3.1 レイアウト

```
+---------------------------+---------------------------+
|                           |                           |
|      左側パネル            |      右側パネル            |
|   (演出エリア)             |   (数独グリッド)           |
|                           |                           |
|   - 回路基板アニメーション   |   - 9x9 マス目            |
|   - 解析ステータス表示      |   - コントロールボタン      |
|                           |   - 設定項目              |
|                           |                           |
+---------------------------+---------------------------+
```

### 3.2 左側パネル（演出エリア）

- **回路基板アニメーション**
  - 解析中に光が回路を走るようなエフェクト
  - ネオンカラー（シアン、マゼンタ、グリーン）
  - パルス状の光の点滅
  - 解析状態に応じて光の流れる速度が変化

- **解析ステータス**
  - 現在の探索ノード数
  - バックトラック回数
  - 経過時間

### 3.3 右側パネル（数独グリッド）

- **9x9 マス目**
  - 3x3 ブロックごとに区切り線
  - 初期値（固定値）と入力値の視覚的区別
  - 探索中のセルをハイライト表示
  - バックトラック時は赤色でフラッシュ

- **コントロールボタン**
  - `manual-fill`: 手動入力モード
  - `auto-fill`: 自動生成モード
  - `run`: 解析開始

- **設定項目**
  - 最小解析時間（秒）: 5秒〜60秒（スライダー）

---

## 4. 機能要件

### 4.1 manual-fill（手動入力モード）

- セルをクリックして1〜9の数字を入力可能
- 数独ルール違反時は入力を拒否し、エラー表示
  - 同一行に重複する数字
  - 同一列に重複する数字
  - 同一3x3ブロックに重複する数字
- 入力済みセルをクリックで数字を削除可能
- キーボード入力対応（1-9, Backspace/Delete）

### 4.2 auto-fill（自動生成モード）

- ボタン押下で可解な数独パズルを自動生成
- 生成アルゴリズム:
  1. 完成した数独盤面を生成
  2. ランダムにセルを空にする（17〜30セル残し）
  3. 唯一解を持つことを検証
- 生成中はローディング表示

### 4.3 run（解析実行）

- 深さ優先探索（DFS）アルゴリズムで解析
- **視覚化要件**:
  - 各セルへの数字の試行をリアルタイム表示
  - バックトラック時の数字削除も表示
  - 現在探索中のセルをハイライト
- **タイミング制御**:
  - 最小解析時間を保証（デフォルト5秒）
  - 各ステップ間に適切な遅延を挿入
  - 解が見つかっても最小時間まで演出を継続
- 解析完了時:
  - 成功: 緑色のフラッシュ効果
  - 失敗（解なし）: 赤色のフラッシュ効果

---

## 5. アルゴリズム仕様

### 5.1 深さ優先探索（DFS）

```
function solve(board):
    cell = findEmptyCell(board)
    if cell is null:
        return true  // 解が見つかった

    for num in 1 to 9:
        if isValid(board, cell, num):
            board[cell] = num
            visualize(cell, num)  // 視覚化

            if solve(board):
                return true

            board[cell] = 0
            visualizeBacktrack(cell)  // バックトラック視覚化

    return false
```

### 5.2 タイミング制御

- ステップ間の遅延時間を動的に計算
- `delay = (minTime - elapsedTime) / remainingSteps`
- 最小遅延: 10ms
- 最大遅延: 500ms

---

## 6. UI/UX 要件

### 6.1 カラーパレット

| 用途 | カラーコード |
|------|-------------|
| 背景（メイン） | #0a0a0f |
| 背景（パネル） | #1a1a2e |
| ネオンシアン | #00fff5 |
| ネオンマゼンタ | #ff00ff |
| ネオングリーン | #39ff14 |
| グリッド線 | #3a3a5c |
| テキスト | #e0e0e0 |
| エラー | #ff3366 |
| 成功 | #00ff88 |

### 6.2 フォント

- グリッド内数字: 等幅フォント（JetBrains Mono / Fira Code）
- UI要素: システムフォント

### 6.3 レスポンシブ対応

- PC優先（最小幅: 1024px）
- モバイルでは縦並びレイアウトにフォールバック

---

## 7. 非機能要件

- **パフォーマンス**: 60fps のアニメーション維持
- **ブラウザ対応**: Chrome, Firefox, Safari, Edge（最新版）
- **アクセシビリティ**: キーボード操作対応

---

## 8. ファイル構成（予定）

```
sudoku/
├── doc/
│   └── requirements.md
├── src/
│   ├── components/
│   │   ├── SudokuGrid.tsx       # 9x9グリッド
│   │   ├── Cell.tsx             # 個別セル
│   │   ├── ControlPanel.tsx     # ボタン群
│   │   ├── CircuitAnimation.tsx # 回路アニメーション
│   │   └── StatusDisplay.tsx    # ステータス表示
│   ├── hooks/
│   │   ├── useSudokuSolver.ts   # DFSソルバー
│   │   └── useAnimation.ts      # アニメーション制御
│   ├── utils/
│   │   ├── sudokuGenerator.ts   # パズル生成
│   │   └── validator.ts         # ルール検証
│   ├── App.tsx
│   ├── main.tsx
│   └── index.css
├── index.html
├── package.json
├── tailwind.config.js
├── tsconfig.json
└── vite.config.ts
```

---

## 9. 開発フェーズ

1. **Phase 1**: プロジェクトセットアップ、基本UI構築
2. **Phase 2**: 数独グリッド、入力機能実装
3. **Phase 3**: DFSソルバー、視覚化実装
4. **Phase 4**: 回路アニメーション実装
5. **Phase 5**: タイミング制御、仕上げ
